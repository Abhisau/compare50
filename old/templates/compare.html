<!DOCTYPE html>

<html lang="en">

    <head>

        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>

        <link href="/static/favicon.ico" rel="icon"/>

        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet"/>
        <link href="https://cdn.datatables.net/1.10.16/css/dataTables.bootstrap.css" rel="stylesheet"/>
        <link href="/static/toolkit-minimal.min.css" rel="stylesheet"/>
        <link href="/static/styles.css" rel="stylesheet"/>

        <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
        <script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
        <script src="https://cdn.datatables.net/1.10.16/js/dataTables.bootstrap.js"></script>
        <script src="/static/toolkit.min.js"></script>
        <script src="/static/dropzone.js"></script>

        <script>
          function select_pass(pass_id) {
              console.log(`selecting pass ${pass_id}`);

              // remove old listeners and highlights
              $('.frag').off();
              $('.highlight').removeClass('highlight');

              // recalculate match fragments
              $('.match').removeClass('match');
              $(`.frag[data-pass-${pass_id}]`).addClass('match');

              // remove distro matches
              $('.distro').removeClass('distro');
              $(`.match[data-pass-${pass_id}~="distro"]`)
                  .removeClass('match')
                  .addClass('distro');

              // set up highlight on hover for matches
              $('.match').hover(function() {
                  $(this).data(`pass-${pass_id}`).toString().split(' ')
                      .forEach(function(group) {
                          $(`.match[data-pass-${pass_id}~=${group}]`)
                              .addClass('highlight');
                      });
              },
              function() {
                  $('.highlight').removeClass('highlight');
              });
          }

          $(document).ready(function() {
              $('.pass_selector').change(function() {
                  select_pass(this.value);
              });
              select_pass({{passes[0].id}});
          });
        </script>

        <title>CS50 Compare</title>

    </head>

    <body>

      <div class="container">
        <h1>Compare50 Results</h1>
        {% for p in passes %}
          <input type="radio" class="pass_selector" name="pass" value="{{p.id}}" {% if loop.first %} checked{% endif %}>
          <label>{{p.config}}</label>
        {% endfor %}
        <div class="container">
          {% for sub, files, side in (sub_a, files_a, "left"), (sub_b, files_b, "right") %}
            <div class="split {{side}}">
              <div class="submission-file">
                <h3>{{sub}}</h3>
              </div>
              {% for file, fragments in files %}
                <div class="submission-file">
                  <h4>{{file}}</h4>
                  <pre>
                    {%- for frag in fragments -%}
                      <code class="frag"
                        {%- for pass_id, groups in frag.groups.items() -%}
                          data-pass-{{pass_id}}="{% for group in groups -%}
                                                 {{group}}{% if not loop.last %} {% endif -%}
                                                 {%- endfor -%}"
                          {%- if not loop.last %} {% endif -%}
                        {%- endfor -%}
                      >{{frag.text}}</code>
                    {%- endfor -%}
                  </pre>
                </div>
              {% endfor %}
            </div>
          {% endfor %}

        </div>
      </div>
    </body>

</html>
